//
//  YCProjectDetailViewController.swift
//  YunChou
//
//  Created by yy on 2018/9/29.
//  Copyright Â© 2018å¹´ grx. All rights reserved.
//

import UIKit

class YCProjectDetailViewController: UIViewController {
    
    private lazy var titles: [String] = {
        return ["é¡¹ç›®ä»‹ç»", "æŠ•èµ„æ–¹æ¡ˆ", "ä¿¡æ¯æŠ«éœ²"]
    }()
    
    private lazy var viewControllers: [UIViewController] = [TwoTestViewController(),TwoTestViewController(),YCInfoOpenViewController()]
    
//    private lazy var projectHeader : YCProjectHeaderView = {
//       let project = YCProjectHeaderView.init(frame: CGRect(x: 0, y: 0, width: Main_Screen_Width, height: 548))
//        return project
//    }()
    
    
    private lazy var layout: LTLayout = {
        let layout = LTLayout()
        layout.bottomLineHeight = 4.0
        layout.bottomLineCornerRadius = 2.0
        layout.isShowBackImage = false
        
        layout.titleViewBgColor = UIColor.white
        layout.scale = 1.1
        layout.titleColor = YC_FontColor_LightGray
        layout.titleSelectColor = YC_Color_DarkBlue
        layout.titleFont = YC_FONT_PFSC_Medium(15)
        layout.bottomLineColor = YC_Color_DarkBlue
        layout.isAverage = true
        layout.lrMargin = 30
        layout.sliderWidth = 18
        layout.toBottomHeight = 5
        layout.sliderHeight = 50
        /* æ›´å¤šå±žæ€§è®¾ç½®è¯·å‚è€ƒ LTLayout ä¸­ public å±žæ€§è¯´æ˜Ž */
        return layout
    }()

    private func managerReact() -> CGRect {
        return CGRect(x: 0, y: 0, width: Main_Screen_Width, height: Main_Screen_Height - 50-SafeBottomMargin)
    }
    
    private lazy var simpleManager: LTSimpleManager = {
        let simpleManager = LTSimpleManager(frame: managerReact(), viewControllers: viewControllers, titles: titles, currentViewController: self, layout: self.layout)
        /* è®¾ç½®ä»£ç† ç›‘å¬æ»šåŠ¨ */
        simpleManager.delegate = self
        simpleManager.hoverY = StatusBarHeight
        return simpleManager
    }()
    
    
    private lazy var bottomView : YCProjectBottomView = {
       let bottom = YCProjectBottomView()
        return bottom
    }()
    
    override func viewDidLoad() {
        super.viewDidLoad()
        view.backgroundColor = UIColor.white
        self.automaticallyAdjustsScrollViewInsets = false
        view.addSubview(self.simpleManager)
        simpleManagerConfig()
        
        view.addSubview(bottomView)
        bottomView.snp.makeConstraints { (make) in
            make.left.right.equalTo(0)
            make.height.equalTo(50+SafeBottomMargin)
            make.bottom.equalTo(0)
        }
    }
    
    func setStatusBarBackgroundColor(color : UIColor) {
        let statusBarWindow : UIView = UIApplication.shared.value(forKey: "statusBarWindow") as! UIView
        let statusBar : UIView = statusBarWindow.value(forKey: "statusBar") as! UIView
        if statusBar.responds(to:#selector(setter: UIView.backgroundColor)) {
            statusBar.backgroundColor = color
        }
    }
}

extension YCProjectDetailViewController {
    
    //MARK: å…·ä½“ä½¿ç”¨è¯·å‚è€ƒä»¥ä¸‹
    private func simpleManagerConfig() {
        
        //MARK: headerViewè®¾ç½®
        simpleManager.configHeaderView {[weak self] in
            guard let strongSelf = self else { return nil }
            let headerView = strongSelf.headerView()
            return headerView
        }
        
        //MARK: pageViewç‚¹å‡»äº‹ä»¶
        simpleManager.didSelectIndexHandle { (index) in
            print("ç‚¹å‡»äº† \(index) ðŸ˜†")
        }
        
    }
    
    @objc private func tapLabel(_ gesture: UITapGestureRecognizer)  {
        print("tapLabelâ˜„")
    }
}

extension YCProjectDetailViewController: LTSimpleScrollViewDelegate {
    
    //MARK: æ»šåŠ¨ä»£ç†æ–¹æ³•
    func glt_scrollViewDidScroll(_ scrollView: UIScrollView) {
//                print("offset -> ", scrollView.contentOffset.y)
        if scrollView.contentOffset.y >= 548-StatusBarHeight{
            setStatusBarBackgroundColor(color: UIColor.white)
        }else{
            setStatusBarBackgroundColor(color: UIColor.clear)
        }
    }
    
    //MARK: æŽ§åˆ¶å™¨åˆ·æ–°äº‹ä»¶ä»£ç†æ–¹æ³•
    func glt_refreshScrollView(_ scrollView: UIScrollView, _ index: Int) {
        //æ³¨æ„è¿™é‡Œå¾ªçŽ¯å¼•ç”¨é—®é¢˜ã€‚
//        scrollView.mj_header = MJRefreshNormalHeader {[weak scrollView] in
//            DispatchQueue.main.asyncAfter(deadline: .now() + 1.0, execute: {
//                print("å¯¹åº”æŽ§åˆ¶å™¨çš„åˆ·æ–°è‡ªå·±çŽ©å§ï¼Œè¿™é‡Œå°±ä¸åšå¤„ç†äº†ðŸ™‚-----\(index)")
//                scrollView?.mj_header.endRefreshing()
//            })
//        }
    }
}

extension YCProjectDetailViewController {
    private func headerView() -> YCProjectHeaderView {
        let project = YCProjectHeaderView.init(frame: CGRect(x: 0, y: 0, width: Main_Screen_Width, height: 328+kWidth(R: 220)))
        return project
    }
}
